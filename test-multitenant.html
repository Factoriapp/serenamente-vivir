<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEST: Sistema Multi-Tenant - Serenamente Vivir</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,700&family=Source+Sans+Pro:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        body {
            font-family: 'Source Sans Pro', sans-serif;
            background: #f5f3f0;
            padding: 2rem;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        .test-header {
            background: linear-gradient(135deg, var(--color-primary, #e7cf9d), var(--color-secondary, #c9e1e1));
            color: #333;
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            text-align: center;
        }
        .test-header h1 {
            margin: 0;
            font-family: 'Playfair Display', serif;
            font-style: italic;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .test-card {
            background: #f1ede2;
            border: 2px solid #c9e1e1;
            border-radius: 10px;
            padding: 1.5rem;
        }
        .test-card h3 {
            color: #c9e1e1;
            margin: 0 0 1rem 0;
            font-family: 'Playfair Display', serif;
        }
        .test-value {
            background: white;
            padding: 0.75rem;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin: 0.5rem 0;
            border-left: 4px solid var(--color-primary, #e7cf9d);
        }
        .color-preview {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            display: inline-block;
            margin-left: 0.5rem;
            border: 2px solid #333;
        }
        .status {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 600;
            display: inline-block;
            margin: 0.5rem 0;
        }
        .status.success {
            background: #cae4b2;
            color: #155724;
        }
        .status.error {
            background: #dc3545;
            color: white;
        }
        .status.warning {
            background: #e7cf9d;
            color: #333;
        }
        .log-console {
            background: #1e1e1e;
            color: #00ff00;
            padding: 1rem;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 1rem;
        }
        .log-line {
            margin: 0.25rem 0;
        }
        .feature-list {
            list-style: none;
            padding: 0;
        }
        .feature-list li {
            padding: 0.5rem;
            margin: 0.25rem 0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .feature-list li.enabled {
            background: rgba(202, 228, 178, 0.3);
            color: #155724;
        }
        .feature-list li.disabled {
            background: rgba(220, 53, 69, 0.1);
            color: #666;
            opacity: 0.6;
        }
        .btn-test {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background: #c9e1e1;
            color: #333;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 600;
            margin: 0.5rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-test:hover {
            background: #e7cf9d;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>

    <div class="test-container">
        <!-- Header de prueba -->
        <div class="test-header">
            <h1>üß™ TEST: Sistema Multi-Tenant Whitelabel</h1>
            <p style="margin: 0.5rem 0 0 0; font-family: 'Playfair Display', serif; font-style: italic;">
                <span data-brand="tagline">El permiso de ser, el arte de vivir serenamente</span>
            </p>
            <p style="font-size: 0.9rem; opacity: 0.9; margin-top: 1rem;">
                Tenant actual: <strong id="currentTenant">Cargando...</strong>
            </p>
            <div id="loadingStatus" class="status warning">‚è≥ Cargando configuraci√≥n...</div>
        </div>

        <!-- Grid de pruebas -->
        <div class="test-grid">
            <!-- Card 1: Informaci√≥n del Tenant -->
            <div class="test-card">
                <h3>üìã Informaci√≥n del Tenant</h3>
                <div class="test-value">
                    <strong>ID:</strong> <span id="tenantId">-</span>
                </div>
                <div class="test-value">
                    <strong>Nombre:</strong> <span id="tenantName" data-brand="name">-</span>
                </div>
                <div class="test-value">
                    <strong>Dominio:</strong> <span id="tenantDomain">-</span>
                </div>
                <div class="test-value">
                    <strong>Tipo Profesional:</strong> <span id="professionalType">-</span>
                </div>
            </div>

            <!-- Card 2: Tema Aplicado -->
            <div class="test-card">
                <h3>üé® Tema CSS Aplicado</h3>
                <div class="test-value">
                    <strong>Color Primario:</strong> <span id="primaryColor">-</span>
                    <div class="color-preview" id="primaryColorPreview"></div>
                </div>
                <div class="test-value">
                    <strong>Color Secundario:</strong> <span id="secondaryColor">-</span>
                    <div class="color-preview" id="secondaryColorPreview"></div>
                </div>
                <div class="test-value">
                    <strong>Fuente Principal:</strong> <span id="fontPrimary">-</span>
                </div>
                <div class="test-value">
                    <strong>Fuente Secundaria:</strong> <span id="fontSecondary">-</span>
                </div>
            </div>

            <!-- Card 3: Diccionario Sem√°ntico -->
            <div class="test-card">
                <h3>üìù Diccionario Sem√°ntico</h3>
                <div class="test-value">
                    <strong>client_term:</strong> <span id="clientTerm">-</span>
                </div>
                <div class="test-value">
                    <strong>dashboard_term:</strong> <span id="dashboardTerm">-</span>
                </div>
                <div class="test-value">
                    <strong>session_term:</strong> <span id="sessionTerm">-</span>
                </div>
                <div class="test-value">
                    <strong>booking_term:</strong> <span id="bookingTerm">-</span>
                </div>
            </div>
        </div>

        <!-- Feature Flags -->
        <div class="test-card">
            <h3>üîß Feature Flags</h3>
            <p style="margin-bottom: 1rem; color: #666;">
                Funcionalidades habilitadas/deshabilitadas seg√∫n el tenant:
            </p>
            <ul class="feature-list" id="featureList">
                <li>‚è≥ Cargando features...</li>
            </ul>
        </div>

        <!-- Acciones de Testing -->
        <div class="test-card">
            <h3>‚ö° Acciones de Testing</h3>
            <p style="margin-bottom: 1rem; color: #666;">
                Prueba las funcionalidades del sistema:
            </p>
            <a href="crear-usuarios-prueba.html" class="btn-test">üë• Crear Usuarios de Prueba</a>
            <a href="cuenta.html" class="btn-test">üîê Ir a Login</a>
            <a href="area-privada.html" class="btn-test">üè† √Årea Privada</a>
            <a href="catalogo.html" class="btn-test">üõçÔ∏è Cat√°logo</a>
        </div>

        <!-- Log de Consola -->
        <div class="test-card">
            <h3>üìä Log del Sistema</h3>
            <div class="log-console" id="logConsole">
                <div class="log-line">‚è≥ Esperando carga de configuraci√≥n...</div>
            </div>
        </div>
    </div>

    <!-- Config Loader - Sistema Multi-Tenant -->
    <script src="js/config-loader.js"></script>

    <!-- Script de Testing -->
    <script>
        const logs = [];

        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            logs.push(`[${timestamp}] ${icon} ${message}`);
            updateLogConsole();
        }

        function updateLogConsole() {
            const console = document.getElementById('logConsole');
            console.innerHTML = logs.map(log => `<div class="log-line">${log}</div>`).join('');
            console.scrollTop = console.scrollHeight;
        }

        // Interceptar consola
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.join(' ');
            if (message.includes('[CONFIG-LOADER]')) {
                addLog(message);
            }
        };

        const originalError = console.error;
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog(args.join(' '), 'error');
        };

        // Esperar a que se cargue la configuraci√≥n
        document.addEventListener('tenantConfigLoaded', function(event) {
            const config = event.detail;

            addLog('Configuraci√≥n del tenant cargada exitosamente', 'success');
            addLog(`Tenant ID: ${config.tenant_id}`, 'info');

            // Actualizar estado
            document.getElementById('loadingStatus').className = 'status success';
            document.getElementById('loadingStatus').textContent = '‚úÖ Sistema Multi-Tenant Funcionando';

            // Actualizar informaci√≥n del tenant
            document.getElementById('currentTenant').textContent = config.tenant_id;
            document.getElementById('tenantId').textContent = config.tenant_id;
            document.getElementById('tenantName').textContent = config.brand.name;
            document.getElementById('tenantDomain').textContent = config.domain;
            document.getElementById('professionalType').textContent = config.professional_type;

            // Actualizar tema
            document.getElementById('primaryColor').textContent = config.theme.primary_color;
            document.getElementById('primaryColorPreview').style.backgroundColor = config.theme.primary_color;

            document.getElementById('secondaryColor').textContent = config.theme.secondary_color;
            document.getElementById('secondaryColorPreview').style.backgroundColor = config.theme.secondary_color;

            document.getElementById('fontPrimary').textContent = config.theme.font_primary;
            document.getElementById('fontSecondary').textContent = config.theme.font_secondary;

            addLog(`Tema CSS aplicado: ${config.theme.primary_color}`, 'success');

            // Actualizar diccionario
            document.getElementById('clientTerm').textContent = config.dictionary.client_term;
            document.getElementById('dashboardTerm').textContent = config.dictionary.dashboard_term;
            document.getElementById('sessionTerm').textContent = config.dictionary.session_term;
            document.getElementById('bookingTerm').textContent = config.dictionary.booking_term;

            addLog('Diccionario sem√°ntico aplicado', 'success');

            // Cargar lista de features
            loadFeatureList(config.features);

            addLog('Feature flags aplicados', 'success');
            addLog('='.repeat(50), 'info');
            addLog('‚úÖ SISTEMA MULTI-TENANT FUNCIONANDO CORRECTAMENTE', 'success');
        });

        function loadFeatureList(features) {
            const featureList = document.getElementById('featureList');

            const featureNames = {
                'carta_astral': 'Carta Astral',
                'fases_lunares': 'Fases Lunares',
                'rituales': 'Rituales',
                'energia_sanacion': 'Energ√≠a y Sanaci√≥n',
                'facturacion_avanzada': 'Facturaci√≥n Avanzada',
                'membresia': 'Sistema de Membres√≠a',
                'area_miembros': '√Årea de Miembros',
                'eventos_vivo': 'Eventos en Vivo',
                'cursos_online': 'Cursos Online',
                'blog': 'Blog',
                'testimonios': 'Testimonios',
                'meditaciones': 'Meditaciones',
                'talleres': 'Talleres',
                'retiros': 'Retiros',
                'acompanamiento': 'Acompa√±amiento'
            };

            const featuresHTML = Object.keys(features)
                .filter(key => featureNames[key])
                .map(key => {
                    const enabled = features[key];
                    const icon = enabled ? '‚úì' : '‚úó';
                    const className = enabled ? 'enabled' : 'disabled';
                    return `<li class="${className}">${icon} ${featureNames[key]}</li>`;
                }).join('');

            featureList.innerHTML = featuresHTML;

            const enabledCount = Object.values(features).filter(v => v === true).length;
            addLog(`Features activos: ${enabledCount}/${Object.keys(features).length}`, 'info');
        }

        // Timeout de seguridad
        setTimeout(() => {
            const status = document.getElementById('loadingStatus');
            if (status.classList.contains('warning')) {
                status.className = 'status error';
                status.textContent = '‚ùå Error: No se pudo cargar la configuraci√≥n';
                addLog('ERROR: Timeout al cargar configuraci√≥n', 'error');
                addLog('Verifica que config/tenants/serenamente.json existe', 'warning');
            }
        }, 5000);
    </script>

</body>
</html>


